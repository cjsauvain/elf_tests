#include "codeInjection.h"

static void	Injection(int fd, char *shellcode, int shellcode_len)
{
	//off_t	offset;

	/*offset = getTextSectionCodeCave(fd, ehdr);
	if (offset > 0)
		CodeCaveCase(fd, ehdr, shellcode);*/
	//else
		injectAtEndOfFile(fd, shellcode, shellcode_len);
}

/*void	InjectCode(int fd)
{
	char	shellcode[] = {
			0x48, 0x31, 0xc0,
			0xb8, 0x40, 0x17, 0x20, 0x00,
			0xff, 0xe0
	};

	//memcpy(shellcode + 4, &old_entry, 3);
	Injection(fd, shellcode);
}*/

void	InjectCode(int fd)
{
	char	shellcode[] = {
			0x48, 0x31, 0xc0,
			0xbf, 0x01, 0x00, 0x00, 0x00,
			0x48, 0x8d, 0x35, 0x18, 0x00, 0x00, 0x00,
			0xba, 0x0e, 0x00, 0x00, 0x00,
			0xb8, 0x01, 0x00, 0x00, 0x00,
			0x0f, 0x05,
			0x48, 0x31, 0xd2,
			0x41, 0xb8, 0x20, 0x17, 0x40, 0x00, //old entry
			0x41, 0xff, 0xe0,
			0x2e, 0x2e, 0x2e, 0x2e, 0x57,
			0x4f,
			0x4f,
			0x44, 0x59,
			0x2e, 0x2e, 0x2e, 0x2e, 0x0a,
	};
	//memcpy(shellcode + 34, &old_entry, 3);
	Injection(fd, shellcode, sizeof(shellcode));
}
